!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("node-fetch"),require("axios"),require("form-data"),require("cheerio")):"function"==typeof define&&define.amd?define(["node-fetch","axios","form-data","cheerio"],r):(e=e||self).cep=r(e.fetch,e.fetch$1,e.FormData,e.cheerio)}(this,function(o,n,a,c){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function r(r,e){var t,o=Object.keys(r);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(r),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),o.push.apply(o,t)),o}function s(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(Object(a),!0).forEach(function(e){var r,t,o;r=n,o=a[t=e],t in r?Object.defineProperty(r,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[t]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})}return n}function e(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&p(e,r)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,r){return(p=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function f(e,r,t){return(f=l()?Reflect.construct:function(e,r,t){var o=[null];o.push.apply(o,r);var n=new(Function.bind.apply(e,o));return t&&p(n,t.prototype),n}).apply(null,arguments)}function d(e){var o="function"==typeof Map?new Map:void 0;return(d=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(e))return o.get(e);o.set(e,t)}function t(){return f(e,arguments,u(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),p(t,e)})(e)}function h(e,r){return!r||"object"!=typeof r&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function m(t){var o=l();return function(){var e,r=u(t);return h(this,o?(e=u(this).constructor,Reflect.construct(r,arguments,e)):r.apply(this,arguments))}}function v(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,r){if(e){if("string"==typeof e)return g(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?g(e,r):void 0}}function g(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c;var b=function(){e(c,d(Error));var a=m(c);function c(){var e,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=r.message,o=r.type,n=r.errors;return i(this,c),(e=a.call(this)).name="CepPromiseError",e.message=t,e.type=o,e.errors=n,e}return c}(),w=function(){e(a,d(Error));var n=m(a);function a(){var e,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=r.message,o=r.service;return i(this,a),(e=n.call(this)).name="ServiceError",e.message=t,e.service=o,e}return a}();function E(e){var r="".concat(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"","https://apps.correios.com.br/SigepMasterJPA/AtendeClienteService/AtendeCliente"),t={method:"POST",body:'<?xml version="1.0"?>\n<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cli="http://cliente.bean.master.sigep.bsb.correios.com.br/">\n  <soapenv:Header />\n  <soapenv:Body>\n    <cli:consultaCEP>\n      <cep>'.concat(e,"</cep>\n    </cli:consultaCEP>\n  </soapenv:Body>\n</soapenv:Envelope>"),headers:{"Content-Type":"text/xml;charset=UTF-8","cache-control":"no-cache"}};return o(r,t).then(O).catch(C)}function O(e){return e.ok?e.text().then(P).then(S):e.text().then(j).then(x)}function P(e){try{var r;return(null!==(r=e.replace(/\r?\n|\r/g,"").match(/<return>(.*)<\/return>/)[0])&&void 0!==r?r:"").replace("<return>","").replace("</return>","").split(/</).reduce(function(e,r){var t=r.split(">");return 1<t.length&&t[1].length&&(e[t[0]]=t[1]),e},{})}catch(e){throw new Error("Não foi possível interpretar o XML de resposta.")}}function j(e){try{var r;return(null!==(r=e.match(/<faultstring>(.*)<\/faultstring>/)[0])&&void 0!==r?r:"").replace("<faultstring>","").replace("</faultstring>","")}catch(e){throw new Error("Não foi possível interpretar o XML de resposta.")}}function x(e){throw new Error(e)}function S(e){return{cep:e.cep,state:e.uf,city:e.cidade,neighborhood:e.bairro,street:e.end,service:"correios"}}function C(e){var r=new w({message:e.message,service:"correios"});throw"FetchError"===e.name&&(r.message="Erro ao se conectar com o serviço dos Correios."),r}function A(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",t=new a;t.append("cep",e);var o={method:"post",url:"".concat(r,"http://www.buscacep.correios.com.br/sistemas/buscacep/detalhaCEP.cfm"),headers:s({},t.getHeaders()),data:t,responseEncoding:"Latin1"};return n(o).then(F).then(_).catch(D)}var F=function(e){if(200!==e.status)throw new Error("Erro ao se conectar com o serviço dos correios.");return e.data},_=function(e){function r(e){return e.replace(/\&#xE0;/g,"à").replace(/\&#xE1;/g,"á").replace(/\&#xE2;/g,"â").replace(/\&#xE3;/g,"ã").replace(/\&#xE7;/g,"ç").replace(/\&#xE8;/g,"è").replace(/\&#xE9;/g,"é").replace(/\&#xEA;/g,"ê").replace(/\&#xEC;/g,"ì").replace(/\&#xED;/g,"í").replace(/\&#xF2;/g,"ò").replace(/\&#xF3;/g,"ó").replace(/\&#xF4;/g,"ô").replace(/\&#xF5;/g,"õ").replace(/\&#xF9;/g,"ù").replace(/\&#xFA;/g,"ú").replace(/\&#xFB;/g,"û")}var t=c.load(e);if("DADOS ENCONTRADOS COM SUCESSO."!=t("div.ctrlcontent p").html())throw new Error("CEP não encontrado na base de dados dos Correios.");var o=t("table.tmptabela"),n=t(o).find("tr:nth-child(3) td:nth-child(2)").html().split("/");return{cep:t(o).find("tr:nth-child(4) td:nth-child(2)").html().toString().replace(/\D+/g,""),state:n[1],city:r(n[0]),neighborhood:r(t(o).find("tr:nth-child(2) td:nth-child(2)").html()).trim(),street:r(t(o).find("tr:nth-child(1) td:nth-child(2)").html()).trim(),service:"correiosBusca"}},D=function(e){"Request failed with status code 400"!==e.message&&"getaddrinfo ENOTFOUND apps.correios.com.br apps.correios.com.br:443"!==e.message||(e.message="Erro ao se conectar com o serviço dos Correios.");var r=new w({message:e.message,service:"correiosbusca"});throw"FetchError"===e.name&&(r.message="Erro ao se conectar com o serviço dos Correios."),r};function T(e){var r="".concat(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"","https://viacep.com.br/ws/").concat(e,"/json/");return o(r,{method:"GET",mode:"cors",headers:{"content-type":"application/json;charset=utf-8","user-agent":""}}).then(N).then(R).then(I).catch(M)}function N(e){if(e.ok)return e.json();throw Error("Erro ao se conectar com o serviço ViaCEP.")}function R(e){if(!0===e.erro)throw new Error("CEP não encontrado na base do ViaCEP.");return e}function I(e){return{cep:e.cep.replace("-",""),state:e.uf,city:e.localidade,neighborhood:e.bairro,street:e.logradouro,service:"viacep"}}function M(e){var r=new w({message:e.message,service:"viacep"});throw"FetchError"===e.name&&(r.message="Erro ao se conectar com o serviço ViaCEP."),r}function k(e){var r="".concat(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"","https://cep.widenet.host/busca-cep/api/cep/").concat(e,".json");return o(r,{method:"GET",mode:"cors",headers:{"content-type":"application/json;charset=utf-8"}}).then(q).then(B).then(z).catch(U)}function q(e){if(e.ok)return e.json();throw Error("Erro ao se conectar com o serviço WideNet.")}function B(e){if(!1===e.ok||200!==e.status)throw new Error("CEP não encontrado na base do WideNet.");return e}function z(e){return{cep:e.code.replace("-",""),state:e.state,city:e.city,neighborhood:e.district,street:e.address,service:"widenet"}}function U(e){var r=new w({message:e.message,service:"widenet"});throw"FetchError"===e.name&&(r.message="Erro ao se conectar com o serviço WideNet."),r}function V(e){var r="https://brasilapi.com.br/api/cep/v1/".concat(e);return o(r,{method:"GET",mode:"cors",headers:{"content-type":"application/json;charset=utf-8"}}).then(G).then(L).catch(W)}function G(e){if(!1===e.ok||200!==e.status)throw new Error("CEP não encontrado na base do BrasilAPI.");return e.json()}function L(e){return{cep:e.cep,state:e.state,city:e.city,neighborhood:e.neighborhood,street:e.street,service:"brasilapi"}}function W(e){var r=new w({message:e.message,service:"brasilapi"});throw"FetchError"===e.name&&(r.message="Erro ao se conectar com o serviço BrasilAPI."),r}function H(t){return new Promise(function(e,r){return Promise.resolve(t).then(r,e)})}Promise.any=function(e){return H(Promise.all(v(e).map(H)))};var X=Promise,$=8;function J(e){var r=t(e);if("number"===r||"string"===r)return e;throw new b({message:"Erro ao inicializar a instância do CepPromise.",type:"validation_error",errors:[{message:"Você deve chamar o construtor utilizando uma String ou um Number.",service:"cep_validation"}]})}function K(e){return e.toString().replace(/\D+/g,"")}function Q(e){return"0".repeat($-e.length)+e}function Y(e){if(e.length<=$)return e;throw new b({message:"CEP deve conter exatamente ".concat($," caracteres."),type:"validation_error",errors:[{message:"CEP informado possui mais do que ".concat($," caracteres."),service:"cep_validation"}]})}function Z(e){if(void 0!==e.length)throw new b({message:"Todos os serviços de CEP retornaram erro.",type:"service_error",errors:e});throw e}function ee(e){var r=e.message,t=e.type,o=e.errors;throw new b({message:r,type:t,errors:o})}return function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return X.resolve(e).then(J).then(function(e){return n.providers=n.providers?n.providers:[],function(e){var r=["brasilapi","correios","viacep","widenet"];if(!Array.isArray(e))throw new b({message:"Erro ao inicializar a instância do CepPromise.",type:"validation_error",errors:[{message:"O parâmetro providers deve ser uma lista.",service:"providers_validation"}]});var t,o=function(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=y(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return c=e.done,e},e:function(e){i=!0,a=e},f:function(){try{c||null==t.return||t.return()}finally{if(i)throw a}}}}(e);try{for(o.s();!(t=o.n()).done;){var n=t.value;if(!r.includes(n))throw new b({message:"Erro ao inicializar a instância do CepPromise.",type:"validation_error",errors:[{message:'O provider "'.concat(n,'" é inválido. Os providers disponíveis são: ["').concat(r.join('", "'),'"].'),service:"providers_validation"}]});return}}catch(e){o.e(e)}finally{o.f()}}(n.providers),e}).then(K).then(Y).then(Q).then(function(e){return r=e,t=n,o="undefined"!=typeof window?{correiosbusca:A,viacep:T,widenet:k,brasilapi:V}:{correiosbusca:A,correios:E,viacep:T,widenet:k,brasilapi:V},0!==t.providers.length?X.any(t.providers.map(function(e){return o[e](r)})):X.any(Object.values(o).map(function(e){return e(r)}));var r,t,o}).catch(Z).catch(ee)}});